#!/bin/bash

# ===========================
# Zoom CLI - RNAI Core
# ===========================

ACCOUNT_ID="H747iWXbTU24W54HOma5_A"
CLIENT_ID="oINj9oydR0CDHc2wU1JQGg"
CLIENT_SECRET="xT5zLwh3ly11ok3KPGIIHY5V2gdxpEu7"

get_token() {
  echo "[üîê] Obteniendo token de acceso..."
  RESPONSE=$(curl -s --request POST \
    --url https://zoom.us/oauth/token?grant_type=account_credentials&account_id=$ACCOUNT_ID \
    --header "Authorization: Basic $(echo -n $CLIENT_ID:$CLIENT_SECRET | base64)")

  ACCESS_TOKEN=$(echo $RESPONSE | grep -o '"access_token":"[^"]*' | cut -d':' -f2 | tr -d '"')

  if [[ -z "$ACCESS_TOKEN" ]]; then
    echo "[‚ùå] Error obteniendo token."
  else
    echo "[‚úÖ] Token obtenido correctamente."
    echo "$ACCESS_TOKEN"
  fi
}

create_meeting() {
  echo "[üìû] Creando nueva reuni√≥n..."
  TOKEN=$(get_token)

  curl -s --request POST \
    --url https://api.zoom.us/v2/users/me/meetings \
    --header "Authorization: Bearer $TOKEN" \
    --header "Content-Type: application/json" \
    --data '{
      "topic": "Reuni√≥n RNAI Bot",
      "type": 1,
      "settings": {
        "host_video": true,
        "participant_video": true
      }
    }' | jq
}

list_meetings() {
  echo "[üìã] Listando reuniones..."
  TOKEN=$(get_token)

  curl -s --request GET \
    --url https://api.zoom.us/v2/users/me/meetings \
    --header "Authorization: Bearer $TOKEN" | jq
}

help() {
  echo "Comandos disponibles Zoom CLI:"
  echo "  token         ‚Üí Obtener token de acceso"
  echo "  new           ‚Üí Crear una nueva reuni√≥n"
  echo "  list          ‚Üí Listar reuniones programadas"
  echo "  help          ‚Üí Mostrar esta ayuda"
}

case "$1" in
  token) get_token ;;
  new) create_meeting ;;
  list) list_meetings ;;
  help|*) help ;;
esac

